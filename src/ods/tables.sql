-- Create database/schema
CREATE OR REPLACE DATABASE TPCDI_ODS;

CREATE OR REPLACE SCHEMA TPCDI_ODS.PUBLIC;

-- CREATE TABLE STATEMENT

CREATE OR REPLACE TABLE TPCDI_ODS.PUBLIC.ACCOUNT_ODS ( CA_ID INT NOT NULL COMMENT 'CUSTOMER ACCOUNT IDENTIFIER', CA_B_ID INT COMMENT 'IDENTIFIER OF THE MANAGING BROKER', CA_C_ID INT NOT NULL COMMENT 'OWNING CUSTOMER IDENTIFIER', CA_NAME CHAR(50) COMMENT 'NAME OF CUSTOMER ACCOUNT', CA_TAX_ST INT COMMENT '0, 1 OR 2 TAX STATUS OF THIS ACCOUNT', CA_ST_ID CHAR(4) COMMENT 'ACTV OR INAC CUSTOMER STATUS TYPE IDENTIFIER', LAST_UPDATED_TS TIMESTAMP_LTZ NOT NULL COMMENT 'LAST TIME THIS RECORD WAS INSERTED OR UPDATED' ) ;

CREATE OR REPLACE STREAM TPCDI_ODS.PUBLIC.ACCOUNT_ODS_STM
ON TABLE TPCDI_ODS.PUBLIC.ACCOUNT_ODS
;
-- CREATE TABLE STATEMENT

CREATE OR REPLACE TABLE TPCDI_ODS.PUBLIC.CUSTOMER_ODS ( C_ID INT NOT NULL COMMENT 'CUSTOMER IDENTIFIER', C_TAX_ID CHAR(20) NOT NULL COMMENT 'CUSTOMER’S TAX IDENTIFIER', C_ST_ID CHAR(4) COMMENT 'ACTV OR INAC CUSTOMER STATUS TYPE IDENTIFIER', C_L_NAME CHAR(25) NOT NULL COMMENT 'PRIMARY CUSTOMER''S LAST NAME.', C_F_NAME CHAR(20) NOT NULL COMMENT 'PRIMARY CUSTOMER''S FIRST NAME.', C_M_NAME CHAR(1) COMMENT 'PRIMARY CUSTOMER''S MIDDLE INITIAL', C_GNDR CHAR(1) COMMENT 'GENDER OF THE PRIMARY CUSTOMER', C_TIER NUMBER(1) COMMENT 'CUSTOMER TIER', C_DOB DATE NOT NULL COMMENT 'CUSTOMER’S DATE OF BIRTH, AS YYYY-MM-DD.', C_ADLINE1 CHAR(80) NOT NULL COMMENT 'ADDRESS LINE 1', C_ADLINE2 CHAR(80) COMMENT 'ADDRESS LINE 2', C_ZIPCODE CHAR(12) NOT NULL COMMENT 'ZIP OR POSTAL CODE', C_CITY CHAR(25) NOT NULL COMMENT 'CITY', C_STATE_PROV CHAR(20) NOT NULL COMMENT 'STATE OR PROVINCE', C_CTRY CHAR(24) COMMENT 'COUNTRY', C_CTRY_1 CHAR(3) COMMENT 'COUNTRY CODE FOR CUSTOMER''S PHONE 1.', C_AREA_1 CHAR(3) COMMENT 'AREA CODE FOR CUSTOMER''S PHONE 1.', C_LOCAL_1 CHAR(10) COMMENT 'LOCAL NUMBER FOR CUSTOMER''S PHONE 1.', C_EXT_1 CHAR(5) COMMENT 'EXTENSION NUMBER FOR CUSTOMER''S PHONE 1.', C_CTRY_2 CHAR(3) COMMENT 'COUNTRY CODE FOR CUSTOMER''S PHONE 2.', C_AREA_2 CHAR(3) COMMENT 'AREA CODE FOR CUSTOMER''S PHONE 2.', C_LOCAL_2 CHAR(10) COMMENT 'LOCAL NUMBER FOR CUSTOMER''S PHONE 2.', C_EXT_2 CHAR(5) COMMENT 'EXTENSION NUMBER FOR CUSTOMER''S PHONE 2.', C_CTRY_3 CHAR(3) COMMENT 'COUNTRY CODE FOR CUSTOMER''S PHONE 3.', C_AREA_3 CHAR(3) COMMENT 'AREA CODE FOR CUSTOMER''S PHONE 3.', C_LOCAL_3 CHAR(10) COMMENT 'LOCAL NUMBER FOR CUSTOMER''S PHONE 3.', C_EXT_3 CHAR(5) COMMENT 'EXTENSION NUMBER FOR CUSTOMER''S PHONE 3.', C_EMAIL_1 CHAR(100) COMMENT 'CUSTOMER''S E-MAIL ADDRESS 1.', C_EMAIL_2 CHAR(100) COMMENT 'CUSTOMER''S E-MAIL ADDRESS 2.', C_LCL_TX_ID CHAR(4) NOT NULL COMMENT 'CUSTOMER''S LOCAL TAX RATE', C_NAT_TX_ID CHAR(4) NOT NULL COMMENT 'CUSTOMER''S NATIONAL TAX RATE', LAST_UPDATED_TS TIMESTAMP_LTZ NOT NULL COMMENT 'LAST TIME THIS RECORD WAS INSERTED OR UPDATED' ) ;

CREATE OR REPLACE STREAM TPCDI_ODS.PUBLIC.CUSTOMER_ODS_STM
ON TABLE TPCDI_ODS.PUBLIC.CUSTOMER_ODS
;
-- CREATE TABLE STATEMENT

CREATE OR REPLACE TABLE TPCDI_ODS.PUBLIC.FINWIRE_CMP_ODS ( PTS TIMESTAMP_NTZ NOT NULL COMMENT 'POSTING DATE & TIME AS YYYYMMDD-HHMMSS', REC_TYPE VARCHAR(3) NOT NULL COMMENT 'CMP', COMPANY_NAME VARCHAR(60) NOT NULL COMMENT 'NAME OF THE COMPANY', CIK VARCHAR(10) NOT NULL COMMENT 'COMPANY IDENTIFICATION CODE FROM SEC', STATUS VARCHAR(4) NOT NULL COMMENT 'ACTV FOR ACTIVE COMPANY, INAC FOR INACTIVE', INDUSTRY_ID VARCHAR(2) NOT NULL COMMENT 'CODE FOR INDUSTRY SEGMENT', SP_RATING VARCHAR(4) NOT NULL COMMENT 'S&P RATING', FOUNDING_DATE DATE COMMENT 'A DATE AS YYYYMMDD', ADDR_LINE1 VARCHAR(80) NOT NULL COMMENT 'MAILING ADDRESS', ADDR_LINE2 VARCHAR(80) COMMENT 'MAILING ADDRESS', POSTAL_CODE VARCHAR(12) NOT NULL COMMENT 'MAILING ADDRESS', CITY VARCHAR(25) NOT NULL COMMENT 'MAILING ADDRESS', STATE_PROVINCE VARCHAR(20) NOT NULL COMMENT 'MAILING ADDRESS', COUNTRY VARCHAR(24) COMMENT 'MAILING ADDRESS', CEO_NAME VARCHAR(46) NOT NULL COMMENT 'NAME OF COMPANY CEO', DESCRIPTION VARCHAR(150) NOT NULL COMMENT 'DESCRIPTION OF THE COMPANY', LAST_UPDATED_TS TIMESTAMP_LTZ NOT NULL COMMENT 'LAST TIME THIS RECORD WAS INSERTED OR UPDATED' ) ;

-- CREATE STREAM STATEMENT

CREATE OR REPLACE STREAM TPCDI_ODS.PUBLIC.FINWIRE_CMP_ODS_STM ON TABLE TPCDI_ODS.PUBLIC.FINWIRE_CMP_ODS
;
-- CREATE TABLE STATEMENT
-- MOVED TO BEING A VIEW INSTEAD OF A TABLE

CREATE OR REPLACE TABLE TPCDI_ODS.PUBLIC.FINWIRE_FIN_ODS ( PTS TIMESTAMP_NTZ NOT NULL COMMENT 'POSTING DATE & TIME AS YYYYMMDD-HHMMSS', REC_TYPE VARCHAR(3) NOT NULL COMMENT 'FIN', YEAR NUMBER(4,0) NOT NULL COMMENT 'YEAR OF THE QUARTER END', QUARTER NUMBER(1,0) NOT NULL COMMENT 'QUARTER NUMBER: VALID VALUES ARE 1, 2, 3, 4', QTR_START_DATE DATE NOT NULL COMMENT 'START DATE OF QUARTER, AS YYYYMMDD', POSTING_DATE DATE NOT NULL COMMENT 'POSTING DATE OF QUARTERLY REPORT AS YYYYMMDD', REVENUE NUMBER(15,2) NOT NULL COMMENT 'REPORTED REVENUE FOR THE QUARTER', EARNINGS NUMBER(15,2) NOT NULL COMMENT 'NET EARNINGS REPORTED FOR THE QUARTER', EPS NUMBER(10,2) NOT NULL COMMENT 'BASIC EARNINGS PER SHARE FOR THE QUARTER', DILUTED_EPS NUMBER(10,2) NOT NULL COMMENT 'DILUTED EARNINGS PER SHARE FOR THE QUARTER', MARGIN NUMBER(10,2) NOT NULL COMMENT 'PROFIT DIVIDED BY REVENUES FOR THE QUARTER', INVENTORY NUMBER(15,2) NOT NULL COMMENT 'VALUE OF INVENTORY ON HAND AT END OF QUARTER', ASSETS NUMBER(15,2) NOT NULL COMMENT 'VALUE OF TOTAL ASSETS AT THE END OF QUARTER', LIABILITIES NUMBER(15,2) NOT NULL COMMENT 'VALUE OF TOTAL LIABILITIES AT THE END OF QUARTER', SH_OUT NUMBER(13,0) NOT NULL COMMENT 'AVERAGE NUMBER OF SHARES OUTSTANDING', DILUTED_SH_OUT NUMBER(13,0) NOT NULL COMMENT 'AVERAGE NUMBER OF SHARES OUTSTANDING (DILUTED)', CO_NAME_OR_CIK VARCHAR(60) NOT NULL COMMENT 'COMPANY CIK NUMBER (IF ONLY DIGITS, 10 VARCHARS) OR NAME (IF NOT ONLY DIGITS, 60 VARCHARS)', LAST_UPDATED_TS TIMESTAMP_LTZ NOT NULL COMMENT 'LAST TIME THIS RECORD WAS INSERTED OR UPDATED' ) ;

-- CREATE STREAM STATEMENT

CREATE OR REPLACE STREAM TPCDI_ODS.PUBLIC.FINWIRE_FIN_ODS_STM ON TABLE TPCDI_ODS.PUBLIC.FINWIRE_FIN_ODS
;
-- CREATE TABLE STATEMENT
-- MOVED TO BEING A VIEW INSTEAD OF A TABLE

CREATE OR REPLACE TABLE TPCDI_ODS.PUBLIC.FINWIRE_SEC_ODS ( PTS TIMESTAMP_NTZ NOT NULL COMMENT 'POSTING DATE & TIME AS YYYYMMDD-HHMMSS', REC_TYPE VARCHAR(3) NOT NULL COMMENT '“SEC”', SYMBOL VARCHAR(15) NOT NULL COMMENT 'SECURITY SYMBOL', ISSUE_TYPE VARCHAR(6) NOT NULL COMMENT 'ISSUE TYPE', STATUS VARCHAR(4) NOT NULL COMMENT 'ACTV FOR ACTIVE SECURITY, INAC FOR INACTIVE', NAME VARCHAR(70) NOT NULL COMMENT 'SECURITY NAME', EX_ID VARCHAR(6) NOT NULL COMMENT 'ID OF THE EXCHANGE THE SECURITY IS TRADED ON', SH_OUT NUMBER(13,0) NOT NULL COMMENT 'NUMBER OF SHARES OUTSTANDING', FIRST_TRADE_DATE DATE NOT NULL COMMENT 'DATE OF FIRST TRADE AS YYYYMMDD', FIRST_TRADE_EXCHG DATE NOT NULL COMMENT 'DATE OF FIRST TRADE ON EXCHANGE AS YYYYMMDD', DIVIDEND NUMBER(10,2) NOT NULL COMMENT 'DIVIDEND AS VALUE_T', CO_NAME_OR_CIK VARCHAR(60) NOT NULL COMMENT 'COMPANY CIK NUMBER (IF ONLY DIGITS, 10 CHARS) OR NAME (IF NOT ONLY DIGITS, 60 CHARS)', LAST_UPDATED_TS TIMESTAMP_LTZ NOT NULL COMMENT 'LAST TIME THIS RECORD WAS INSERTED OR UPDATED' ) ;

-- CREATE STREAM STATEMENT

CREATE OR REPLACE STREAM TPCDI_ODS.PUBLIC.FINWIRE_SEC_ODS_STM ON TABLE TPCDI_ODS.PUBLIC.FINWIRE_SEC_ODS
;
-- CREATE TABLE STATEMENT

CREATE OR REPLACE TABLE TPCDI_ODS.PUBLIC.TRADE_ODS ( T_ID NUMBER(15) NOT NULL COMMENT 'TRADE IDENTIFIER.', T_DTS DATETIME NOT NULL COMMENT 'DATE AND TIME OF TRADE.', T_DT DATE NOT NULL COMMENT 'DATE OF TRADE.', T_ST_ID CHAR(4) NOT NULL COMMENT 'STATUS TYPE IDENTIFIER', T_TT_ID CHAR(3) NOT NULL COMMENT 'TRADE TYPE IDENTIFIER', T_IS_CASH INT COMMENT 'IS THIS TRADE A CASH (1) OR MARGIN (0) TRADE?', T_S_SYMB CHAR(15) NOT NULL COMMENT 'SECURITY SYMBOL OF THE SECURITY', T_QTY NUMBER(6) COMMENT 'QUANTITY OF SECURITIES TRADED.', T_BID_PRICE NUMBER(8,2) COMMENT 'THE REQUESTED UNIT PRICE.', T_CA_ID NUMBER(11) NOT NULL COMMENT 'CUSTOMER ACCOUNT IDENTIFIER.', T_EXEC_NAME CHAR(49) NOT NULL COMMENT 'NAME OF THE PERSON EXECUTING THE TRADE.', T_TRADE_PRICE NUMBER(8,2) COMMENT 'UNIT PRICE AT WHICH THE SECURITY WAS TRADED.', T_CHRG NUMBER(10,2) COMMENT 'FEE CHARGED FOR PLACING THIS TRADE REQUEST.', T_COMM NUMBER(10,2) COMMENT 'COMMISSION EARNED ON THIS TRADE', T_TAX NUMBER(10,2) COMMENT 'AMOUNT OF TAX DUE ON THIS TRADE', LAST_UPDATED_TS TIMESTAMP_LTZ NOT NULL COMMENT 'LAST TIME THIS RECORD WAS INSERTED OR UPDATED' ) ;

CREATE OR REPLACE STREAM TPCDI_ODS.PUBLIC.TRADE_ODS_STM
ON TABLE TPCDI_ODS.PUBLIC.TRADE_ODS
;
